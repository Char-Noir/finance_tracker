<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Картка списку</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <header class="bg-primary text-white text-center py-3">
        <h1>Картка списку</h1>
    </header>

    <main class="container mt-4">
        <div class="d-flex justify-content-between mb-3">
            <button class="btn btn-secondary" onclick="goBack()">Назад</button>
            <button class="btn btn-success" onclick="addList()">Додати список</button>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th onclick="sortTable('id')">ID</th>
                    <th onclick="sortTable('name')">Назва</th>
                    <th onclick="sortTable('author')">Автор</th>
                    <th>Дії</th>
                </tr>
            </thead>
            <tbody id="list-table-body">
            </tbody>
        </table>
        
        <div class="d-flex justify-content-between">
            <button class="btn btn-secondary" onclick="changePage(-1)" id="prev-btn" disabled>Попередня</button>
            <span id="page-info">Сторінка 1</span>
            <button class="btn btn-secondary" onclick="changePage(1)" id="next-btn">Наступна</button>
        </div>
    </main>

    <footer class="bg-light text-center py-3 mt-4">
        <p>&copy; 2025 Finance Tracker</p>
    </footer>

    <script>
        let currentPage = 1;
        let totalPages = 1;
        let currentSort = { column: 'id', order: 'desc' };

        async function fetchLists(sortBy = 'id', order = 'desc', page = 1) {
            try {
                const response = await fetch(`https://192.168.31.146/api/lists?page=${page}&size=10&sort_by=${sortBy}&order=${order}`);
                const data = await response.json();
                updateTable(data.lists);
                totalPages = data.total_pages;
                currentPage = data.current_page;
                updatePagination();
            } catch (error) {
                console.error('Помилка завантаження списків:', error);
            }
        }

        function updateTable(lists) {
            const tableBody = document.getElementById('list-table-body');
            tableBody.innerHTML = '';
            lists.forEach(list => {
                const row = `<tr>
                    <td>${list.id}</td>
                    <td>${list.name}</td>
                    <td>${list.author}</td>
                    <td><a href="list_card.html?id=${list.id}" class="btn btn-primary">Відкрити</a></td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.order = currentSort.order === 'desc' ? 'asc' : 'desc';
            } else {
                currentSort.column = column;
                currentSort.order = 'desc';
            }
            fetchLists(currentSort.column, currentSort.order, currentPage);
        }

        function changePage(step) {
            if ((step === -1 && currentPage > 1) || (step === 1 && currentPage < totalPages)) {
                currentPage += step;
                fetchLists(currentSort.column, currentSort.order, currentPage);
            }
        }

        function updatePagination() {
            document.getElementById('page-info').textContent = `Сторінка ${currentPage} з ${totalPages}`;
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage === totalPages;
        }

        function goBack() {
            window.history.back();
        }

        function addList() {
            const name = prompt("Введіть назву нового списку:");
            if (name) {
                fetch(`https://192.168.31.146/api/lists/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: name, author: 'Користувач' })
                })
                .then(() => {
                    alert('Список додано!');
                    fetchLists(currentSort.column, currentSort.order, currentPage);
                })
                .catch(error => console.error('Помилка додавання списку:', error));
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchLists();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
