<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker - Джерела Даних</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <header class="bg-primary text-white text-center py-3">
        <h1>Джерела Даних</h1>
    </header>

    <div class="container mt-5">
        <div style="display: flex; justify-content: space-between;">
            <a href="/" class="btn btn-primary mb-3" >Назад</a>
             <!-- Кнопка додати -->
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">Додати</button>
        </div>
        <!-- Список джерел -->
        <table class="table table-bordered mt-4">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Назва</th>
                    <th>Дії</th>
                </tr>
            </thead>
            <tbody id="dataSourcesTable">
                <!-- Тут будуть рендеритись дані через JS -->
            </tbody>
        </table>


        <!-- Модальне вікно для додавання -->
        <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Додати Джерело Даних</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addForm">
                            <div class="mb-3">
                                <label for="addName" class="form-label">Назва</label>
                                <input type="text" class="form-control" id="addName" required minlength="3">
                                <div class="invalid-feedback">Назва повинна містити більше 3 символів.</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Додати</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальне вікно для оновлення -->
        <div class="modal fade" id="updateModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Оновити Джерело Даних</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="updateForm">
                            <input type="hidden" id="updateId">
                            <div class="mb-3">
                                <label for="updateName" class="form-label">Назва</label>
                                <input type="text" class="form-control" id="updateName" required minlength="3">
                                <div class="invalid-feedback">Назва повинна містити більше 3 символів.</div>
                            </div>
                            <button type="submit" class="btn btn-primary">Оновити</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const apiUrl = "https://192.168.31.146/api/data-sources"; // Базова URL для бекенду

        const dataSourcesTable = document.getElementById("dataSourcesTable");

        // Завантаження джерел із бекенду
        async function loadDataSources() {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error("Помилка завантаження даних");
                const data = await response.json();
                renderTable(data);
            } catch (error) {
                console.error("Error loading data sources:", error);
            }
        }

        // Рендеринг таблиці
        function renderTable(dataSources) {
            dataSourcesTable.innerHTML = "";
            dataSources.forEach(source => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${source.id}</td>
                    <td>${source.name}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="openUpdateModal(${source.id}, '${source.name}')">Оновити</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteSource(${source.id})">Видалити</button>
                    </td>
                `;
                dataSourcesTable.appendChild(row);
            });
        }

        // Відкрити модальне вікно для оновлення
        function openUpdateModal(id, name) {
            document.getElementById("updateId").value = id;
            document.getElementById("updateName").value = name;
            const updateModal = new bootstrap.Modal(document.getElementById("updateModal"));
            updateModal.show();
        }

        // Додати джерело
        document.getElementById("addForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            const name = document.getElementById("addName").value.trim();
            if (name.length > 3) {
                try {
                    const response = await fetch(apiUrl, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ name })
                    });
                    if (!response.ok) throw new Error("Помилка додавання джерела");
                    loadDataSources();
                    bootstrap.Modal.getInstance(document.getElementById("addModal")).hide();
                } catch (error) {
                    console.error("Error adding data source:", error);
                }
            }
        });

        // Оновити джерело
        document.getElementById("updateForm").addEventListener("submit", async function(e) {
            e.preventDefault();
            const id = document.getElementById("updateId").value;
            const name = document.getElementById("updateName").value.trim();
            if (name.length > 3) {
                try {
                    const response = await fetch(`${apiUrl}/${id}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ name })
                    });
                    if (!response.ok) throw new Error("Помилка оновлення джерела");
                    loadDataSources();
                    bootstrap.Modal.getInstance(document.getElementById("updateModal")).hide();
                } catch (error) {
                    console.error("Error updating data source:", error);
                }
            }
        });

        // Видалити джерело
        async function deleteSource(id) {
            try {
                const response = await fetch(`${apiUrl}/${id}`, {
                    method: "DELETE"
                });
                if (!response.ok) throw new Error("Помилка видалення джерела");
                loadDataSources();
            } catch (error) {
                console.error("Error deleting data source:", error);
            }
        }

        // Ініціалізація таблиці
        loadDataSources();
    </script>
 <footer class="bg-light text-center py-3 mt-4">
    <p>&copy; 2025 Finance Tracker</p>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>